"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1548],{1548:(Ee,j,u)=>{u.r(j),u.d(j,{CartPageModule:()=>Ae});var y=u(177),b=u(4341),d=u(4742),O=u(8288),g=u(467),e=u(4438),T=u(2431),F=u(671),I=u(7423),$=u(2152);function w(o,a){if(1&o){const r=e.RV6();e.j41(0,"div",4)(1,"div",5),e.nrm(2,"img",6),e.k0s(),e.j41(3,"div",7)(4,"h4"),e.EFF(5),e.k0s(),e.j41(6,"div",8),e.EFF(7),e.nI1(8,"currency"),e.k0s(),e.j41(9,"div",9)(10,"button",10),e.bIt("click",function(){const n=e.eBV(r).$implicit,i=e.XpG();return e.Njj(i.updateQuantity(n,-1))}),e.EFF(11,"-"),e.k0s(),e.j41(12,"span",11),e.EFF(13),e.k0s(),e.j41(14,"button",10),e.bIt("click",function(){const n=e.eBV(r).$implicit,i=e.XpG();return e.Njj(i.updateQuantity(n,1))}),e.EFF(15,"+"),e.k0s()()()()}if(2&o){const r=a.$implicit;e.R7$(2),e.Y8G("src",""===r.image?"assets/default.png":r.image,e.B4B)("alt","Image of "+r.title),e.R7$(3),e.JRh(r.title),e.R7$(2),e.JRh(e.bMT(8,7,r.price)),e.R7$(3),e.BMQ("aria-label","Decrease quantity of "+r.title),e.R7$(3),e.JRh(r.quantity),e.R7$(),e.BMQ("aria-label","Increase quantity of "+r.title)}}let G=(()=>{var o;class a{constructor(t,n){this.cartService=t,this.accessibilityService=n,this.items=[]}ngOnInit(){this.cartService.cart$.subscribe(t=>{this.items=t})}updateQuantity(t,n){const i=t.quantity+n;this.accessibilityService.announce(i<1?`Removed ${t.title} from your cart.`:`Updated ${t.title} quantity to ${i}.`,"polite"),this.cartService.updateQuantity(t.id,i)}calculateSubtotal(){const t=this.items.reduce((n,i)=>n+Number(i.price)*i.quantity,0);return this.accessibilityService.announce(`Subtotal updated to ${t.toFixed(2)} dollars.`,"polite"),t}}return(o=a).\u0275fac=function(t){return new(t||o)(e.rXU(T.m),e.rXU(I.s))},o.\u0275cmp=e.VBU({type:o,selectors:[["app-cart-items"]],inputs:{items:"items"},decls:10,vars:4,consts:[[1,"cart-container"],["class","cart-item",4,"ngFor","ngForOf"],["routerLink","/home","aria-label","Add more items to your cart",1,"add-more-button"],["aria-live","polite",1,"subtotal"],[1,"cart-item"],[1,"item-image"],[3,"src","alt"],[1,"item-details"],[1,"item-price"],[1,"quantity-controls"],[3,"click"],["aria-live","polite","aria-atomic","true"]],template:function(t,n){1&t&&(e.j41(0,"div",0),e.DNE(1,w,16,9,"div",1),e.j41(2,"ion-button",2),e.EFF(3,"+ Add more items"),e.k0s(),e.j41(4,"div",3)(5,"span"),e.EFF(6,"Subtotal"),e.k0s(),e.j41(7,"span"),e.EFF(8),e.nI1(9,"currency"),e.k0s()()()),2&t&&(e.R7$(),e.Y8G("ngForOf",n.items),e.R7$(7),e.JRh(e.bMT(9,2,n.calculateSubtotal())))},dependencies:[y.Sq,d.Jm,d.N7,O.Wk,y.oe],styles:[".cart-container[_ngcontent-%COMP%]{padding:16px}.cart-container[_ngcontent-%COMP%]   .cart-item[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:16px}.cart-container[_ngcontent-%COMP%]   .cart-item[_ngcontent-%COMP%]   .item-image[_ngcontent-%COMP%]{width:125px;height:125px}.cart-container[_ngcontent-%COMP%]   .cart-item[_ngcontent-%COMP%]   .item-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;border-radius:8px}.cart-container[_ngcontent-%COMP%]   .cart-item[_ngcontent-%COMP%]   .item-details[_ngcontent-%COMP%]{flex:1;margin-left:12px}.cart-container[_ngcontent-%COMP%]   .cart-item[_ngcontent-%COMP%]   .item-details[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:14px;margin:0}.cart-container[_ngcontent-%COMP%]   .cart-item[_ngcontent-%COMP%]   .item-details[_ngcontent-%COMP%]   .item-price[_ngcontent-%COMP%]{font-weight:700;margin:4px 0}.cart-container[_ngcontent-%COMP%]   .cart-item[_ngcontent-%COMP%]   .item-details[_ngcontent-%COMP%]   .quantity-controls[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-end}.cart-container[_ngcontent-%COMP%]   .cart-item[_ngcontent-%COMP%]   .item-details[_ngcontent-%COMP%]   .quantity-controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], .cart-container[_ngcontent-%COMP%]   .cart-item[_ngcontent-%COMP%]   .item-details[_ngcontent-%COMP%]   .quantity-controls[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:20px}.cart-container[_ngcontent-%COMP%]   .cart-item[_ngcontent-%COMP%]   .item-details[_ngcontent-%COMP%]   .quantity-controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border:none;width:32px;height:32px;color:var(--ion-color-dark);background-color:#e0e0e0;padding:4px 8px;margin:0 4px;border-radius:4px;cursor:pointer}.cart-container[_ngcontent-%COMP%]   .cart-item[_ngcontent-%COMP%]   .item-details[_ngcontent-%COMP%]   .quantity-controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#d6d6d6}.cart-container[_ngcontent-%COMP%]   .cart-item[_ngcontent-%COMP%]   .item-details[_ngcontent-%COMP%]   .quantity-controls[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{min-width:24px;margin:0 12px;font-weight:700;text-align:center}.cart-container[_ngcontent-%COMP%]   .add-more-button[_ngcontent-%COMP%]{width:100%;cursor:pointer;margin-bottom:16px;text-transform:capitalize}.cart-container[_ngcontent-%COMP%]   .subtotal[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-size:16px;font-weight:700;padding:16px 0}"]}),a})();window.Aerosync=class{constructor(o){this.iframeDetails={},this.options=o||{},this.options.onLoad=this.options.onLoad||function(){},this.options.onClose=this.options.onClose||function(){},this.options.onSuccess=this.options.onSuccess||function(){},this.options.onEvent=this.options.onEvent||function(){},this.options.onError=this.options.onError||function(){},window.addEventListener("message",this._onPostMessage.bind(this))}launch(){let o="?token="+this.options.token+(this.options.consumerId?`&consumerId=${this.options.consumerId}`:"")+(this.options.deeplink?`&deeplink=${this.options.deeplink}`:"")+(this.options.domain?`&domain=${this.options.domain}`:"")+(this.options.handleMFA?`&handleMFA=${this.options.handleMFA}&jobId=${this.options.jobId}&userId=${this.options.userId}`:""),a=this.options.style&&this.options.style.bgColor&&this.options.style.opacity?this.options.style.bgColor+Math.floor(255*this.options.style.opacity).toString(16):"#000000b2",r="sandbox"===this.options.environment?"https://sandbox.aerosync.com/"+o:"staging"===this.options.environment?"https://staging.aerosync.com/"+o:"dev"===this.options.environment?"https://qa.aerosync.com/"+o:"production"===this.options.environment?"https://www.aerosync.com/"+o:"",t=this.options.style&&this.options.style.width?this.options.style.width:"375px",n=this.options.style&&this.options.style.height?this.options.style.height:"688px",i=document.createElement("iframe"),s=document.createElement("div");this.targetDocument=this.options.targetDocument||document,i.setAttribute("width",t),i.setAttribute("height",n),i.setAttribute("border","0"),i.setAttribute("frame","0"),i.setAttribute("frameborder","0"),i.setAttribute("allowTransparency","true"),i.setAttribute("src",r),i.setAttribute("marginheight","0"),i.setAttribute("marginwidth","0"),i.onload=()=>{this.options.onLoad()},i.setAttribute("title",this.options.iframeTitle),s.setAttribute("id","widget-box"),this.targetElement=this.targetDocument.getElementById(this.options.id),this.targetElement.innerHTML="",this.targetElement.appendChild(s);let c=this.targetDocument.getElementById("widget-box");c.style.display="flex",c.style.position="fixed",c.style.width="100%",c.style.left="0",c.style.top="0",c.style.backgroundColor=a,c.style.zIndex=this.options.zIndex||"1",c.style.height="100%",c.style.justifyContent="center",c.style.alignItems="center",window.matchMedia("(max-height: 700px)").matches&&i.setAttribute("height","95%"),c.innerHTML="",c.appendChild(i),this.iframeDetails={iframe:i}}_onPostMessage(o){let a={};if(this.iframeDetails&&this.iframeDetails.iframe&&o.source===this.iframeDetails.iframe.contentWindow){try{a=JSON.parse(o.data)}catch(r){console.warn("Error processing event",r)}a.type&&this._handleEvent(a)}}_handleEvent(o){switch(o.type){case"pageSuccess":this.options.onSuccess(o.payload);break;case"widgetPageLoaded":this.options.onEvent(o.payload,o.type);break;case"widgetLoaded":this.options.onLoad();break;case"widgetClose":this.targetDocument.querySelector('iframe[title="'+this.options.iframeTitle+'"]').remove(),this.targetDocument.querySelector("#widget-box").remove(),this.options.onClose();break;case"widgetError":this.options.onError(o.payload)}}};var R=u(5083),v=u(6648),M=u(8141),_=u(5312);const A={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let D;const N=new Uint8Array(16),m=[];for(let o=0;o<256;++o)m.push((o+256).toString(16).slice(1));const Y=function V(o,a,r){var t,n,i,s;if(A.randomUUID&&!a&&!o)return A.randomUUID();const c=null!==(t=null!==(n=(o=o||{}).random)&&void 0!==n?n:null===(i=(s=o).rng)||void 0===i?void 0:i.call(s))&&void 0!==t?t:function X(){if(!D){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");D=crypto.getRandomValues.bind(crypto)}return D(N)}();if(c.length<16)throw new Error("Random bytes length must be >= 16");if(c[6]=15&c[6]|64,c[8]=63&c[8]|128,a){if((r=r||0)<0||r+16>a.length)throw new RangeError(`UUID byte range ${r}:${r+15} is out of buffer bounds`);for(let l=0;l<16;++l)a[r+l]=c[l];return a}return function E(o,a=0){return(m[o[a+0]]+m[o[a+1]]+m[o[a+2]]+m[o[a+3]]+"-"+m[o[a+4]]+m[o[a+5]]+"-"+m[o[a+6]]+m[o[a+7]]+"-"+m[o[a+8]]+m[o[a+9]]+"-"+m[o[a+10]]+m[o[a+11]]+m[o[a+12]]+m[o[a+13]]+m[o[a+14]]+m[o[a+15]]).toLowerCase()}(c)};let z=(()=>{var o;class a{constructor(){this.merchantToken=null,this.usedForMerchantToken=null}httpPost(t,n,i){return(0,g.A)(function*(){const s={"Content-Type":"application/json",accept:"application/json",...i?{authorizationToken:`Bearer ${i}`}:{}};return t.includes("/user")&&(s["X-API-Version"]="1.1"),console.log(s),R.pX.post({url:t,headers:s,data:n})})()}httpGet(t,n){return(0,g.A)(function*(){const i={url:t,headers:{"Content-Type":"application/json",accept:"application/json",...n?{authorizationToken:`Bearer ${n}`}:{}}};return R.pX.get(i)})()}fetchMerchantToken(){return(0,v.H)(this.httpPost(`${_.c.aeropay_url}/token`,{scope:"merchant",api_key:_.c.aeropay_api_key,api_secret:_.c.aeropay_api_secret,id:_.c.aeropay_merchant_id})).pipe((0,M.M)(n=>{var i;null!==(i=n.data)&&void 0!==i&&i.token&&this.setMerchantToken(n.data.token,n.data.TTL)}))}fetchUsedForMerchantToken(t){return(0,v.H)(this.httpPost(`${_.c.aeropay_url}/token`,{scope:"userForMerchant",api_key:_.c.aeropay_api_key,api_secret:_.c.aeropay_api_secret,id:_.c.aeropay_merchant_id,userId:t})).pipe((0,M.M)(i=>{var s;null!==(s=i.data)&&void 0!==s&&s.token&&this.setUsedForMerchantToken(i.data.token,i.data.TTL)}))}createUser(t){return(0,v.H)(this.httpPost(`${_.c.aeropay_url}/user`,t,this.getMerchantToken()||"")).pipe((0,M.M)(n=>console.log(n)))}verifyUser(t,n){return(0,v.H)(this.httpPost(`${_.c.aeropay_url}/confirmUser`,{userId:t,code:n},this.getMerchantToken()||"")).pipe((0,M.M)(i=>console.log(i)))}getAerosyncCredentials(){return(0,v.H)(this.httpGet(`${_.c.aeropay_url}/aggregatorCredentials?aggregator=aerosync`,this.getUsedForMerchantToken()||"")).pipe((0,M.M)(t=>console.log(t)))}linkBankAccount(t,n){return(0,v.H)(this.httpPost(`${_.c.aeropay_url}/linkAccountFromAggregator`,{user_id:t,user_password:n,aggregator:"aerosync"},this.getUsedForMerchantToken()||"")).pipe((0,M.M)(s=>console.log(s)))}createTransaction(t,n){const i=Y();return(0,v.H)(this.httpPost(`${_.c.aeropay_url}/transaction`,{amount:t,merchantId:_.c.aeropay_merchant_id,uuid:i,bankAccountId:n},this.getUsedForMerchantToken()||"")).pipe((0,M.M)(c=>console.log(c)))}setMerchantToken(t,n){this.merchantToken=t}getMerchantToken(){return this.merchantToken}isMerchantTokenValid(){return null!==this.getMerchantToken()}setUsedForMerchantToken(t,n){this.usedForMerchantToken=t}getUsedForMerchantToken(){return this.usedForMerchantToken}isUsedForMerchantTokenValid(){return null!==this.getUsedForMerchantToken()}}return(o=a).\u0275fac=function(t){return new(t||o)},o.\u0275prov=e.jDH({token:o,factory:o.\u0275fac,providedIn:"root"}),a})();var H=u(9216),L=u(2268);function J(o,a){1&o&&(e.j41(0,"p",41),e.EFF(1," Delivery is currently turned off. "),e.k0s())}function q(o,a){1&o&&(e.j41(0,"p",41),e.EFF(1," Orders must be at least $90 for delivery. "),e.k0s())}function Q(o,a){if(1&o){const r=e.RV6();e.j41(0,"ion-datetime",53),e.mxI("ngModelChange",function(n){e.eBV(r);const i=e.XpG(2);return e.DH7(i.selectedDeliveryDate,n)||(i.selectedDeliveryDate=n),e.Njj(n)}),e.bIt("ionChange",function(n){e.eBV(r);const i=e.XpG(2);return e.Njj(i.onDateSelected(n))}),e.k0s()}if(2&o){const r=e.XpG(2);e.R50("ngModel",r.selectedDeliveryDate),e.Y8G("isDateEnabled",r.isDateValid)("min",r.minDate)}}function W(o,a){if(1&o&&(e.j41(0,"ion-select-option",54),e.EFF(1),e.k0s()),2&o){const r=a.$implicit;e.Y8G("value",r.value),e.R7$(),e.SpI(" ",r.display," ")}}function Z(o,a){if(1&o){const r=e.RV6();e.j41(0,"div",42)(1,"h3"),e.EFF(2,"Delivery Address"),e.k0s(),e.j41(3,"ion-item",9)(4,"ion-input",43),e.mxI("ngModelChange",function(n){e.eBV(r);const i=e.XpG();return e.DH7(i.deliveryAddress.street,n)||(i.deliveryAddress.street=n),e.Njj(n)}),e.bIt("ngModelChange",function(){e.eBV(r);const n=e.XpG();return e.Njj(n.onAddressInputChange())}),e.k0s()(),e.j41(5,"ion-item",9)(6,"ion-input",44),e.mxI("ngModelChange",function(n){e.eBV(r);const i=e.XpG();return e.DH7(i.deliveryAddress.apt,n)||(i.deliveryAddress.apt=n),e.Njj(n)}),e.bIt("ngModelChange",function(){e.eBV(r);const n=e.XpG();return e.Njj(n.onAddressInputChange())}),e.k0s()(),e.j41(7,"div",5)(8,"ion-item",6)(9,"ion-input",45),e.mxI("ngModelChange",function(n){e.eBV(r);const i=e.XpG();return e.DH7(i.deliveryAddress.city,n)||(i.deliveryAddress.city=n),e.Njj(n)}),e.bIt("ngModelChange",function(){e.eBV(r);const n=e.XpG();return e.Njj(n.onAddressInputChange())}),e.k0s()(),e.j41(10,"ion-item",6)(11,"ion-input",46),e.mxI("ngModelChange",function(n){e.eBV(r);const i=e.XpG();return e.DH7(i.deliveryAddress.zip,n)||(i.deliveryAddress.zip=n),e.Njj(n)}),e.bIt("ngModelChange",function(){e.eBV(r);const n=e.XpG();return e.Njj(n.onAddressInputChange())}),e.k0s()()(),e.j41(12,"ion-item",47)(13,"ion-label"),e.EFF(14,"State"),e.k0s(),e.j41(15,"ion-text"),e.EFF(16),e.k0s()(),e.j41(17,"div",48)(18,"ion-item",9),e.nrm(19,"ion-datetime-button",49),e.j41(20,"ion-modal",50),e.DNE(21,Q,1,3,"ng-template"),e.k0s()(),e.j41(22,"ion-item",9)(23,"ion-select",51),e.mxI("ngModelChange",function(n){e.eBV(r);const i=e.XpG();return e.DH7(i.selectedDeliveryTime,n)||(i.selectedDeliveryTime=n),e.Njj(n)}),e.DNE(24,W,2,2,"ion-select-option",52),e.k0s()()()()}if(2&o){const r=e.XpG();e.R7$(4),e.R50("ngModel",r.deliveryAddress.street),e.R7$(2),e.R50("ngModel",r.deliveryAddress.apt),e.R7$(3),e.R50("ngModel",r.deliveryAddress.city),e.R7$(2),e.R50("ngModel",r.deliveryAddress.zip),e.R7$(5),e.JRh(r.deliveryAddress.state),e.R7$(4),e.Y8G("keepContentsMounted",!0),e.R7$(3),e.R50("ngModel",r.selectedDeliveryTime),e.R7$(),e.Y8G("ngForOf",r.timeOptions)}}function K(o,a){1&o&&(e.j41(0,"div",55),e.nrm(1,"ion-spinner",56),e.j41(2,"p"),e.EFF(3," Fetching AeroPay details..."),e.k0s()())}function ee(o,a){if(1&o){const r=e.RV6();e.j41(0,"div",57)(1,"p"),e.EFF(2,"Enter the verification code sent to your email:"),e.k0s(),e.j41(3,"ion-input",58),e.mxI("ngModelChange",function(n){e.eBV(r);const i=e.XpG();return e.DH7(i.verificationCode,n)||(i.verificationCode=n),e.Njj(n)}),e.k0s(),e.j41(4,"ion-button",59),e.bIt("click",function(){e.eBV(r);const n=e.XpG();return e.Njj(n.verifyAeroPayUser())}),e.EFF(5,"Verify"),e.k0s()()}if(2&o){const r=e.XpG();e.R7$(3),e.R50("ngModel",r.verificationCode)}}function te(o,a){1&o&&e.nrm(0,"ion-icon",66)}function ne(o,a){if(1&o){const r=e.RV6();e.j41(0,"ion-item",59),e.bIt("click",function(){const n=e.eBV(r).$implicit,i=e.XpG(2);return e.Njj(i.selectBank(n.bankAccountId))}),e.j41(1,"ion-avatar",34),e.nrm(2,"ion-icon",64),e.k0s(),e.j41(3,"ion-label")(4,"h3"),e.EFF(5),e.k0s(),e.j41(6,"p"),e.EFF(7),e.k0s()(),e.DNE(8,te,1,0,"ion-icon",65),e.k0s()}if(2&o){const r=a.$implicit,t=e.XpG(2);e.AVh("selected-bank",t.selectedBankId===r.bankAccountId),e.R7$(5),e.JRh(r.bankName),e.R7$(2),e.SpI("Checking - ****",r.accountLast4,""),e.R7$(),e.Y8G("ngIf",t.selectedBankId===r.bankAccountId)}}function oe(o,a){1&o&&e.nrm(0,"ion-spinner",56)}function ie(o,a){1&o&&(e.j41(0,"span"),e.EFF(1,"Connect Another Bank"),e.k0s())}function re(o,a){if(1&o){const r=e.RV6();e.j41(0,"div",60)(1,"ion-list"),e.DNE(2,ne,9,5,"ion-item",61),e.k0s(),e.j41(3,"ion-button",62),e.bIt("click",function(){e.eBV(r);const n=e.XpG();return e.Njj(n.retrieveAerosyncCredentials())}),e.DNE(4,oe,1,0,"ion-spinner",63)(5,ie,2,0,"span",36),e.k0s()()}if(2&o){const r=e.XpG();e.R7$(2),e.Y8G("ngForOf",r.userBankAccounts),e.R7$(2),e.Y8G("ngIf",r.loadingAerosync),e.R7$(),e.Y8G("ngIf",!r.loadingAerosync)}}function ae(o,a){1&o&&(e.j41(0,"div",67),e.EFF(1," \u{1f389} You're a Premium Member! Orders over $100 get an extra 10% off. "),e.k0s())}function se(o,a){if(1&o&&(e.j41(0,"p"),e.EFF(1," Premium Member Discount (10%): "),e.j41(2,"span"),e.EFF(3),e.nI1(4,"currency"),e.k0s()()),2&o){const r=e.XpG();e.R7$(3),e.SpI("-",e.bMT(4,1,r.premiumDiscountAmount),"")}}function ce(o,a){if(1&o&&(e.j41(0,"p"),e.EFF(1," Staff Discount: "),e.j41(2,"span"),e.EFF(3),e.nI1(4,"currency"),e.k0s()()),2&o){const r=e.XpG();e.R7$(3),e.SpI("-",e.bMT(4,1,r.employeeDiscountAmount),"")}}function de(o,a){if(1&o&&(e.j41(0,"li",68),e.nrm(1,"img",69),e.j41(2,"div",70)(3,"span",71),e.EFF(4),e.k0s(),e.j41(5,"span",72),e.EFF(6),e.k0s()()()),2&o){const r=a.$implicit;e.R7$(),e.Y8G("src",""===r.image?"assets/default.png":r.image,e.B4B)("alt","Image of "+r.title),e.R7$(3),e.SpI("",r.quantity,"x"),e.R7$(2),e.JRh(r.title)}}let le=(()=>{var o;class a{constructor(t,n,i,s,c,l,h,f){this.cartService=t,this.loadingController=n,this.accessibilityService=i,this.toastController=s,this.authService=c,this.aeropayService=l,this.settingsService=h,this.fcmService=f,this.deliveryAddress={street:"",apt:"",city:"",zip:"",state:"NY"},this.minDate="",this.isDatePickerOpen=!1,this.selectedDate=null,this.pointsToRedeem=0,this.showTooltip=!1,this.applyPoints=!1,this.finalSubtotal=0,this.originalSubtotal=0,this.finalTotal=0,this.finalTax=0,this.pointValue=.05,this.selectedTime="",this.isLoading=!1,this.timeOptions=[],this.selectedPaymentMethod="cash",this.selectedOrderType="pickup",this.enableDelivery=!1,this.aeropayAuthToken=null,this.verificationRequired=!1,this.verificationCode="",this.existingUserId="",this.aerosyncURL=null,this.aerosyncToken=null,this.aerosyncUsername=null,this.showAerosyncWidget=!1,this.userBankAccounts=[],this.showBankSelection=!1,this.selectedBankId=null,this.isFetchingAeroPay=!1,this.back=new e.bkB,this.orderPlaced=new e.bkB,this.bankLinked=!1,this.loadingAerosync=!1,this.selectedDeliveryDate=null,this.selectedDeliveryTime="",this.deliveryHoursByDay={0:{start:11,end:21},1:{start:8,end:22},2:{start:8,end:22},3:{start:8,end:22},4:{start:8,end:22},5:{start:8,end:23},6:{start:10,end:23}},this.premiumDiscountRate=.1,this.premiumDiscountApplied=!1,this.premiumDiscountAmount=0,this.employeeDiscountApplied=!1,this.employeeDiscountAmount=0,this.employeeDiscountRate=.15,this.deliverySchedule=[],this.validDeliveryDates=[],this.deliveryAddressValid=!1,this.isDateValid=p=>this.validDeliveryDates.includes(p.split("T")[0])}ngOnInit(){var t=this;return(0,g.A)(function*(){t.calculateDefaultTotals(),t.checkDeliveryEligibility();try{const s=yield t.settingsService.getDeliveryZone();if(s.schedule){t.deliverySchedule=s.schedule;const c=t.getAvailableDeliveryDates(s.schedule);if(t.validDeliveryDates=c,0===c.length)return void t.presentToast("No available delivery days found.","danger");t.selectedDeliveryDate=c[0];const l=new Date(t.selectedDeliveryDate),h=l.getDay();t.generateTimeOptionsFromSchedule(h),t.selectNearestFutureTime(l,h)}}catch(s){console.error("Failed to load delivery zone",s),t.presentToast("Unable to load delivery schedule.","danger")}const n=new Date,i=new Date(n);i.setDate(n.getDate()+1),t.minDate=i.toISOString().split("T")[0]})()}selectNearestFutureTime(t,n){const i=60*t.getHours()+t.getMinutes()+30,s=this.deliveryHoursByDay[n];for(let p=s.start;p<=s.end;p++)for(let C of[0,30])if(60*p+C>=i)return void(this.selectedDeliveryTime=`${p<10?`0${p}`:`${p}`}:${0===C?"00":"30"}`);const c=(n+1)%7,l=new Date(t.getTime()+864e5);this.selectedDeliveryDate=l.toISOString().split("T")[0],this.generateTimeOptionsForDay(c);const f=this.deliveryHoursByDay[c].start;this.selectedDeliveryTime=`${f<10?"0"+f:f}:00`}get maxRedeemablePoints(){const t=Math.min(this.checkoutInfo.user_info.points,20*this.originalSubtotal);return Math.ceil(t)}checkDeliveryEligibility(){this.settingsService.checkDeliveryEligibility().subscribe({next:t=>{this.enableDelivery=t.deliveryAvailable,console.log("Delivery availability:",this.enableDelivery)},error:t=>{console.error("Error fetching delivery eligibility:",t),this.enableDelivery=!1}})}startAeroPayProcess(){var t=this;return(0,g.A)(function*(){t.isFetchingAeroPay=!0,t.aeropayService.fetchMerchantToken().subscribe({next:n=>{if(!1===n.data.success||!n.data.token)return console.error("AeroPay Authentication Failed:",n.error),t.presentToast(`Authentication Error: ${n.error.message}`,"danger"),void(t.isFetchingAeroPay=!1);t.createAeroPayUser()},error:n=>{console.error("AeroPay Authentication Request Failed:",n),t.presentToast("Authentication request failed. Please try again.","danger"),t.isFetchingAeroPay=!1}})})()}createAeroPayUser(){var t=this;return(0,g.A)(function*(){t.aeropayService.createUser({first_name:t.checkoutInfo.user_info.fname,last_name:t.checkoutInfo.user_info.lname,phone_number:t.checkoutInfo.user_info.phone,email:t.checkoutInfo.user_info.email}).subscribe({next:i=>{t.isFetchingAeroPay=!1,i.data.displayMessage?(t.verificationRequired=!0,t.existingUserId=i.data.existingUser.userId,t.presentToast(i.data.displayMessage,"warning")):i.data.success&&i.data.user&&(t.userBankAccounts=i.data.user.bankAccounts||[],t.aeropayUserId=i.data.user.userId,t.userBankAccounts.length>0?(console.log("User has linked bank accounts:",t.userBankAccounts),t.showBankSelection=!0,t.selectedBankId=t.userBankAccounts[0].bankAccountId):(console.log("No linked bank accounts. Opening AeroSync widget..."),t.retrieveAerosyncCredentials()))},error:i=>{console.error("Error Creating AeroPay User:",i),t.presentToast("Error creating user. Please try again.","danger"),t.isFetchingAeroPay=!1}})})()}verifyAeroPayUser(){var t=this;return(0,g.A)(function*(){t.verificationCode.trim()?t.aeropayService.verifyUser(t.existingUserId,t.verificationCode).subscribe({next:n=>{t.verificationRequired=!1,t.presentToast("Verification successful!","success"),t.createAeroPayUser()},error:n=>{console.error("Verification Failed:",n),t.presentToast("Invalid verification code. Please try again.","danger")}}):t.presentToast("Please enter the verification code.","danger")})()}retrieveAerosyncCredentials(){var t=this;return(0,g.A)(function*(){t.loadingAerosync=!0,t.aeropayService.fetchUsedForMerchantToken(t.aeropayUserId).subscribe({next:n=>{if(!1===n.data.success||!n.data.token)return console.error("AeroPay Authentication Failed:",n.data.error),t.presentToast(`Authentication Error: ${n.data.error.message}`,"danger"),void(t.loadingAerosync=!1);t.aeropayService.getAerosyncCredentials().subscribe({next:i=>{i.data.success?(t.aerosyncURL=i.data.fastlinkURL,t.aerosyncToken=i.data.token,t.aerosyncUsername=i.data.username,t.openAerosyncWidget()):console.error("Failed to retrieve Aerosync widget."),t.loadingAerosync=!1},error:i=>{console.error("Error Retrieving Aerosync Widget:",i),t.loadingAerosync=!1}})},error:n=>{console.error("AeroPay Authentication Request Failed:",n),t.presentToast("Authentication request failed. Please try again.","danger"),t.loadingAerosync=!1}})})()}openAerosyncWidget(){this.aerosyncToken?function B(o){return new window.Aerosync(o)}({id:"widget",iframeTitle:"Connect",environment:"production",token:this.aerosyncToken,style:{width:"375px",height:"688px",bgColor:"#000000",opacity:.7},deeplink:"",consumerId:"",onLoad:function(){console.log("AeroSync Widget Loaded")},onSuccess:n=>{n.user_id&&n.user_password?this.linkBankToAeropay(n.user_id,n.user_password):console.error("Missing user credentials in event:",n)},onError:function(n){console.error("AeroSync Error:",n)},onClose:function(){console.log("AeroSync Widget Closed")},onEvent:function(n,i){console.log(n,i)}}).launch():console.error("Missing AeroSync Token")}linkBankToAeropay(t,n){this.aeropayService.linkBankAccount(t,n).subscribe({next:i=>{i.data.success?(this.presentToast("Bank account linked successfully!","success"),this.createAeroPayUser()):(console.error("Failed to link bank:",i.data),this.presentToast("Failed to link your bank. Please try again.","danger"))},error:i=>{console.error("Error linking bank account:",i),this.presentToast("An error occurred while linking your bank.","danger")}})}selectBank(t){this.selectedBankId=t}generateTimeOptionsForDay(t){this.timeOptions=[];const n=this.deliveryHoursByDay[t],s=n.end;for(let c=n.start;c<=s;c++)for(let l of[0,30]){if(c===s&&30===l)break;const C=0===l?"00":"30";this.timeOptions.push({value:`${c<10?`0${c}`:`${c}`}:${C}`,display:`${c%12==0?12:c%12}:${C} ${c<12?"AM":"PM"}`})}}calculateDefaultTotals(){this.finalSubtotal=this.checkoutInfo.cart.reduce((t,n)=>t+n.price*n.quantity,0),this.finalTax=.13*this.finalSubtotal,this.finalTotal=this.finalSubtotal+this.finalTax,this.updateTotals()}updateTotals(){const t=this.pointsToRedeem*this.pointValue;this.originalSubtotal=this.checkoutInfo.cart.reduce((i,s)=>i+s.price*s.quantity,0),this.premiumDiscountApplied=!1,this.premiumDiscountAmount=0,this.employeeDiscountApplied=!1,this.employeeDiscountAmount=0;let n=this.originalSubtotal-t;n<0&&(n=0),this.checkoutInfo.user_info.premium&&this.originalSubtotal>100&&(this.premiumDiscountAmount=n*this.premiumDiscountRate,this.premiumDiscountApplied=!0,n-=this.premiumDiscountAmount),("employee"===this.checkoutInfo.user_info.role||"admin"===this.checkoutInfo.user_info.role)&&(this.employeeDiscountAmount=n*this.employeeDiscountRate,this.employeeDiscountApplied=!0,n-=this.employeeDiscountAmount),this.finalTax=.13*n,this.finalTotal=n+this.finalTax,this.accessibilityService.announce(`Subtotal updated to ${n.toFixed(2)} dollars.`,"polite")}goBack(){this.back.emit(),this.accessibilityService.announce("Returned to the previous page.","polite")}toggleDatePicker(){this.isDatePickerOpen=!this.isDatePickerOpen,this.accessibilityService.announce(this.isDatePickerOpen?"Date picker opened.":"Date picker closed.","polite")}toggleTooltip(){this.showTooltip=!this.showTooltip}onDateSelected(t){const n=t.detail.value;if(!n||(this.selectedDeliveryDate=n.split("T")[0],!this.selectedDeliveryDate))return;const[i,s,c]=this.selectedDeliveryDate.split("-"),h=new Date(this.selectedDeliveryDate).getDay();this.generateTimeOptionsForDay(h),this.accessibilityService.announce(`Selected date is ${s}-${c}-${i}.`,"polite")}placeOrder(){var t=this;return(0,g.A)(function*(){t.isLoading=!0;const n=yield t.loadingController.create({spinner:"crescent",message:"Please wait while we process your order...",cssClass:"custom-loading"});yield n.present();try{const i=t.checkoutInfo.user_info.id,s=t.pointsToRedeem;let c=0,l=0;const h="delivery"===t.selectedOrderType?{address1:t.deliveryAddress.street.trim(),address2:t.deliveryAddress.apt?t.deliveryAddress.apt.trim():null,city:t.deliveryAddress.city.trim(),state:t.deliveryAddress.state.trim(),zip:t.deliveryAddress.zip.trim(),delivery_date:t.selectedDeliveryDate,delivery_eta_start:t.selectedDeliveryTime}:null;"aeropay"===t.selectedPaymentMethod&&t.selectedBankId&&t.aeropayService.fetchUsedForMerchantToken(t.aeropayUserId).subscribe({next:(P=(0,g.A)(function*(x){const k=yield t.aeropayService.createTransaction(t.finalTotal.toFixed(2),t.selectedBankId).toPromise();if(!k.data||!k.data.success)return console.error("AeroPay Transaction Failed:",k.data),t.presentToast("Payment failed. Please try again.","danger"),t.isLoading=!1,void(yield n.dismiss());t.presentToast("Payment successful!","success")}),function(k){return P.apply(this,arguments)}),error:P=>{console.log("Error:",P),t.presentToast("Error","danger")}});const f=yield t.cartService.checkout(s,t.selectedOrderType,h);c=f.id_order,l=f.subtotal,yield t.cartService.placeOrder(i,c,s?0:l,s,t.finalSubtotal,t.checkoutInfo.cart),t.orderPlaced.emit(),yield t.authService.getUserOrders(),t.accessibilityService.announce("Your order has been placed successfully.","polite");const C="delivery"===t.selectedOrderType?"Your delivery order has been placed!":"Your pickup order has been placed!";yield t.fcmService.sendPushNotification(t.checkoutInfo.user_info.id,"Order Confirmed",C)}catch(i){console.error("Error placing order:",i),yield t.presentToast("Error placing order: "+JSON.stringify(i.message)),t.accessibilityService.announce("There was an error placing your order. Please try again.","polite")}finally{t.isLoading=!1,console.log("Cleanup complete: Destroying subscription"),yield n.dismiss()}var P})()}presentToast(t,n="danger"){var i=this;return(0,g.A)(function*(){yield(yield i.toastController.create({message:t,duration:7e3,color:n,position:"bottom"})).present()})()}onOrderTypeChange(t){this.selectedOrderType=t.detail.value,"delivery"===this.selectedOrderType&&(this.selectedPaymentMethod="aeropay",this.startAeroPayProcess())}onPaymentMethodChange(t){"aeropay"===t?this.startAeroPayProcess():this.showBankSelection=!1}onAddressInputChange(){var t=this;return(0,g.A)(function*(){const{street:n,city:i,zip:s}=t.deliveryAddress;if(t.deliveryAddressValid=!1,n.trim()&&i.trim()&&s.trim().length>=5){const c=`${n.trim()}, ${i.trim()}, NY ${s.trim()}`;try{(yield t.settingsService.checkAddressInZone(t.checkoutInfo.business_id,c)).inZone?(t.deliveryAddressValid=!0,console.log("Address is within delivery zone.")):(t.presentToast("This address is outside the delivery zone.","danger"),t.deliveryAddressValid=!1)}catch(l){console.error("Address check error:",l),t.presentToast("Failed to verify delivery address.","danger")}}})()}getAvailableDeliveryDates(t){const n=[],i=new Date;for(let s=0;s<30;s++){const c=new Date;c.setDate(i.getDate()+s);const l=c.toLocaleDateString("en-US",{weekday:"long"});t.find(f=>f.day===l)&&n.push(c.toISOString().split("T")[0])}return n}generateTimeOptionsFromSchedule(t){const n=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][t],i=this.deliverySchedule.find(p=>p.day===n);if(!i)return void(this.timeOptions=[]);const[s,c]=i.startTime.split(":").map(Number),[l,h]=i.endTime.split(":").map(Number),f=[];for(let p=s;p<=l;p++)for(let C of[0,30]){if(p===l&&C>=h)continue;const S=0===C?"00":"30";f.push({value:`${p<10?`0${p}`:`${p}`}:${S}`,display:`${p%12==0?12:p%12}:${S} ${p<12?"AM":"PM"}`})}this.timeOptions=f}}return(o=a).\u0275fac=function(t){return new(t||o)(e.rXU(T.m),e.rXU(d.Xi),e.rXU(I.s),e.rXU(d.K_),e.rXU(F.u),e.rXU(z),e.rXU(H.h),e.rXU(L.Q))},o.\u0275cmp=e.VBU({type:o,selectors:[["app-checkout"]],inputs:{checkoutInfo:"checkoutInfo"},outputs:{back:"back",orderPlaced:"orderPlaced"},decls:107,vars:42,consts:[[1,"checkout-container"],[1,"header"],["role","button","aria-label","Go back to the previous page",1,"back-button",3,"click"],["name","arrow-back-outline","aria-hidden","true"],[1,"section","contact-info"],[1,"input-row"],[1,"rounded-input","half-width"],["name","first","placeholder","First Name","aria-label","First Name",3,"ngModelChange","ngModel"],["name","last","placeholder","Last Name","aria-label","Last Name",3,"ngModelChange","ngModel"],[1,"rounded-input"],["name","email","type","email","placeholder","Email","aria-label","Email Address",3,"ngModelChange","ngModel"],["name","phone","type","tel","placeholder","Phone","aria-label","Phone Number",3,"ngModelChange","ngModel"],[1,"section","order-type"],["aria-label","Select Order Type",3,"ngModelChange","ionChange","ngModel"],["lines","none",1,"radio-item"],["slot","start","value","pickup","checked",""],["slot","start","value","delivery",3,"disabled"],["class","delivery-warning",4,"ngIf"],["class","delivery-address",4,"ngIf"],[1,"section","payment-method"],["aria-label","Select Payment Method",3,"ngModelChange","ngModel"],["slot","start","value","cash",3,"disabled"],["slot","start","value","card",3,"disabled"],["slot","start","value","aeropay"],[1,"aeropay-label"],["src","assets/aeropay.png","alt","Powered by Aeropay",1,"aeropay-image"],["class","loading-container",4,"ngIf"],["class","verification-container",4,"ngIf"],["class","aeropay-banks",4,"ngIf"],[1,"section","order-summary"],["class","premium-banner",4,"ngIf"],["aria-live","polite",1,"summary"],["lines","none",1,"points-slider"],["aria-label","Adjust points to redeem for discount",3,"ngModelChange","ionChange","ngModel","min","max","step"],["slot","start"],["slot","end"],[4,"ngIf"],[1,"section","cart-items"],["class","order-item",4,"ngFor","ngForOf"],["expand","block","aria-label","Place your order",1,"sticky-footer",3,"click","disabled"],["id","widget"],[1,"delivery-warning"],[1,"delivery-address"],["autocomplete","address-line1","name","street","placeholder","Street Address","aria-label","Street Address",3,"ngModelChange","ngModel"],["autocomplete","address-line2","name","apt","placeholder","Apartment / Suite (Optional)","aria-label","Apartment or Suite",3,"ngModelChange","ngModel"],["autocomplete","address-level2","name","city","placeholder","City","aria-label","City",3,"ngModelChange","ngModel"],["autocomplete","postal-code","name","zip","placeholder","ZIP Code","aria-label","ZIP Code",3,"ngModelChange","ngModel"],[1,"rounded-input","readonly-input"],[1,"date-time-container"],["datetime","pickupDate"],[3,"keepContentsMounted"],["placeholder","Select Time",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["id","pickupDate","presentation","date",3,"ngModelChange","ionChange","ngModel","isDateEnabled","min"],[3,"value"],[1,"loading-container"],["name","crescent"],[1,"verification-container"],["placeholder","Verification Code",3,"ngModelChange","ngModel"],[3,"click"],[1,"aeropay-banks"],[3,"selected-bank","click",4,"ngFor","ngForOf"],["expand","full","color","primary",3,"click"],["name","crescent",4,"ngIf"],["name","card-outline","size","large"],["name","checkmark-circle","color","success","slot","end",4,"ngIf"],["name","checkmark-circle","color","success","slot","end"],[1,"premium-banner"],[1,"order-item"],[1,"item-image",3,"src","alt"],[1,"item-details"],[1,"item-quantity"],[1,"item-title"]],template:function(t,n){1&t&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2),e.bIt("click",function(){return n.goBack()}),e.nrm(3,"ion-icon",3),e.k0s(),e.j41(4,"h1"),e.EFF(5,"Cart"),e.k0s()(),e.j41(6,"div",4)(7,"h2"),e.EFF(8,"Contact Information"),e.k0s(),e.j41(9,"form")(10,"div",5)(11,"ion-item",6)(12,"ion-input",7),e.mxI("ngModelChange",function(s){return e.DH7(n.checkoutInfo.user_info.fname,s)||(n.checkoutInfo.user_info.fname=s),s}),e.k0s()(),e.j41(13,"ion-item",6)(14,"ion-input",8),e.mxI("ngModelChange",function(s){return e.DH7(n.checkoutInfo.user_info.lname,s)||(n.checkoutInfo.user_info.lname=s),s}),e.k0s()()(),e.j41(15,"ion-item",9)(16,"ion-input",10),e.mxI("ngModelChange",function(s){return e.DH7(n.checkoutInfo.user_info.email,s)||(n.checkoutInfo.user_info.email=s),s}),e.k0s()(),e.j41(17,"ion-item",9)(18,"ion-input",11),e.mxI("ngModelChange",function(s){return e.DH7(n.checkoutInfo.user_info.phone,s)||(n.checkoutInfo.user_info.phone=s),s}),e.k0s()()()(),e.j41(19,"div",12)(20,"h2"),e.EFF(21,"Order Type"),e.k0s(),e.j41(22,"ion-radio-group",13),e.mxI("ngModelChange",function(s){return e.DH7(n.selectedOrderType,s)||(n.selectedOrderType=s),s}),e.bIt("ionChange",function(s){return n.onOrderTypeChange(s)}),e.j41(23,"ion-item",14),e.nrm(24,"ion-radio",15),e.j41(25,"ion-label"),e.EFF(26,"Pickup"),e.k0s()(),e.j41(27,"ion-item",14),e.nrm(28,"ion-radio",16),e.j41(29,"ion-label"),e.EFF(30,"Delivery"),e.k0s()()(),e.DNE(31,J,2,0,"p",17)(32,q,2,0,"p",17)(33,Z,25,8,"div",18),e.k0s(),e.j41(34,"div",19)(35,"h2"),e.EFF(36,"Payment Method"),e.k0s(),e.j41(37,"ion-radio-group",20),e.mxI("ngModelChange",function(s){return e.DH7(n.selectedPaymentMethod,s)||(n.selectedPaymentMethod=s),s}),e.bIt("ngModelChange",function(s){return n.onPaymentMethodChange(s)}),e.j41(38,"ion-item",14),e.nrm(39,"ion-radio",21),e.j41(40,"ion-label"),e.EFF(41,"In Store - Cash"),e.k0s()(),e.j41(42,"ion-item",14),e.nrm(43,"ion-radio",22),e.j41(44,"ion-label"),e.EFF(45,"In Store - Debit"),e.k0s()(),e.j41(46,"ion-item",14),e.nrm(47,"ion-radio",23),e.j41(48,"ion-label",24),e.nrm(49,"img",25),e.DNE(50,K,4,0,"div",26)(51,ee,6,1,"div",27)(52,re,6,3,"div",28),e.k0s()()()(),e.j41(53,"div",29)(54,"h2"),e.EFF(55,"Order Summary"),e.k0s(),e.DNE(56,ae,2,0,"div",30),e.j41(57,"div",31)(58,"p"),e.EFF(59," Subtotal: "),e.j41(60,"span"),e.EFF(61),e.nI1(62,"currency"),e.k0s()(),e.j41(63,"p"),e.EFF(64," Available Points: "),e.j41(65,"span"),e.EFF(66),e.k0s()(),e.j41(67,"p"),e.EFF(68," Potential Savings: "),e.j41(69,"span"),e.EFF(70),e.nI1(71,"currency"),e.k0s()(),e.j41(72,"p"),e.EFF(73," Points to Redeem: "),e.j41(74,"span"),e.EFF(75),e.k0s()(),e.j41(76,"ion-item",32)(77,"ion-range",33),e.mxI("ngModelChange",function(s){return e.DH7(n.pointsToRedeem,s)||(n.pointsToRedeem=s),s}),e.bIt("ionChange",function(){return n.updateTotals()}),e.j41(78,"ion-label",34),e.EFF(79,"0"),e.k0s(),e.j41(80,"ion-label",35),e.EFF(81),e.k0s()()(),e.j41(82,"p"),e.EFF(83," Discount Applied: "),e.j41(84,"span"),e.EFF(85),e.nI1(86,"currency"),e.k0s()(),e.DNE(87,se,5,3,"p",36)(88,ce,5,3,"p",36),e.j41(89,"p"),e.EFF(90," Tax: "),e.j41(91,"span"),e.EFF(92),e.nI1(93,"currency"),e.k0s()(),e.j41(94,"p"),e.EFF(95," Total: "),e.j41(96,"span"),e.EFF(97),e.nI1(98,"currency"),e.k0s()()()(),e.j41(99,"div",37)(100,"h2"),e.EFF(101,"Your Items"),e.k0s(),e.j41(102,"ul"),e.DNE(103,de,7,4,"li",38),e.k0s()()(),e.j41(104,"ion-button",39),e.bIt("click",function(){return n.placeOrder()}),e.EFF(105," Submit Order\n"),e.k0s(),e.nrm(106,"div",40)),2&t&&(e.R7$(12),e.R50("ngModel",n.checkoutInfo.user_info.fname),e.R7$(2),e.R50("ngModel",n.checkoutInfo.user_info.lname),e.R7$(2),e.R50("ngModel",n.checkoutInfo.user_info.email),e.R7$(2),e.R50("ngModel",n.checkoutInfo.user_info.phone),e.R7$(4),e.R50("ngModel",n.selectedOrderType),e.R7$(6),e.Y8G("disabled",!n.enableDelivery||n.finalTotal<90),e.R7$(3),e.Y8G("ngIf",!n.enableDelivery),e.R7$(),e.Y8G("ngIf",n.enableDelivery&&n.finalTotal<90),e.R7$(),e.Y8G("ngIf","delivery"===n.selectedOrderType),e.R7$(4),e.R50("ngModel",n.selectedPaymentMethod),e.R7$(2),e.Y8G("disabled","delivery"===n.selectedOrderType),e.R7$(4),e.Y8G("disabled","delivery"===n.selectedOrderType),e.R7$(7),e.Y8G("ngIf",n.isFetchingAeroPay),e.R7$(),e.Y8G("ngIf",n.verificationRequired),e.R7$(),e.Y8G("ngIf",n.showBankSelection),e.R7$(4),e.Y8G("ngIf",n.checkoutInfo.user_info.premium),e.R7$(5),e.JRh(e.bMT(62,32,n.finalSubtotal)),e.R7$(5),e.JRh(n.checkoutInfo.user_info.points),e.R7$(4),e.JRh(e.bMT(71,34,n.checkoutInfo.user_info.points*n.pointValue)),e.R7$(5),e.JRh(n.pointsToRedeem),e.R7$(2),e.R50("ngModel",n.pointsToRedeem),e.Y8G("min",0)("max",n.maxRedeemablePoints)("step",1),e.R7$(4),e.JRh(n.maxRedeemablePoints),e.R7$(4),e.JRh(e.bMT(86,36,n.pointsToRedeem*n.pointValue)),e.R7$(2),e.Y8G("ngIf",n.premiumDiscountApplied),e.R7$(),e.Y8G("ngIf",n.employeeDiscountApplied),e.R7$(4),e.JRh(e.bMT(93,38,n.finalTax)),e.R7$(5),e.JRh(e.bMT(98,40,n.finalTotal)),e.R7$(6),e.Y8G("ngForOf",n.checkoutInfo.cart),e.R7$(),e.Y8G("disabled","aeropay"===n.selectedPaymentMethod&&!n.selectedBankId||"delivery"===n.selectedOrderType&&!n.deliveryAddressValid))},dependencies:[y.Sq,y.bT,b.qT,b.BC,b.cb,b.vS,b.cV,d.mC,d.Jm,d.A9,d.K4,d.iq,d.$w,d.uz,d.he,d.nf,d.KO,d.f0,d.Ob,d.Nm,d.Ip,d.w2,d.IO,d.Sb,d.su,d.Je,d.Gw,y.oe],styles:[".checkout-container[_ngcontent-%COMP%]{padding:25px;margin-bottom:50px}.checkout-container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;margin-bottom:16px}.checkout-container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .back-button[_ngcontent-%COMP%]{display:flex;align-items:center;cursor:pointer;font-size:1.2rem;color:#333;transition:color .2s ease-in-out}.checkout-container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .back-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1.5rem}.checkout-container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .back-button[_ngcontent-%COMP%]:hover{color:#4caf50}.checkout-container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{flex:1;text-align:center;font-size:2rem;font-weight:700;margin:0}.checkout-container[_ngcontent-%COMP%]   .section[_ngcontent-%COMP%]{margin-bottom:24px;border-bottom:1px solid #ddd;padding-bottom:16px}.checkout-container[_ngcontent-%COMP%]   .section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.4rem;font-weight:700;margin-bottom:16px}.checkout-container[_ngcontent-%COMP%]   .section[_ngcontent-%COMP%]   .input-row[_ngcontent-%COMP%]{display:flex;gap:12px}.checkout-container[_ngcontent-%COMP%]   .section[_ngcontent-%COMP%]   .rounded-input[_ngcontent-%COMP%]{border-radius:8px;--padding-start: 12px;margin-bottom:16px;z-index:0}.checkout-container[_ngcontent-%COMP%]   .section[_ngcontent-%COMP%]   .radio-item[_ngcontent-%COMP%]{display:flex;padding:8px;border:1px solid #ddd;border-radius:8px;margin:12px 0 8px;align-items:flex-start;z-index:0}.checkout-container[_ngcontent-%COMP%]   .section[_ngcontent-%COMP%]   .radio-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-left:8px;font-weight:700}.checkout-container[_ngcontent-%COMP%]   .section[_ngcontent-%COMP%]   .radio-item[_ngcontent-%COMP%]   ion-radio[_ngcontent-%COMP%]{--size: 24px}.checkout-container[_ngcontent-%COMP%]   .aeropay-label[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-start}.checkout-container[_ngcontent-%COMP%]   #aeropay-button-container[_ngcontent-%COMP%]{margin-top:10px}.checkout-container[_ngcontent-%COMP%]   .summary[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-size:1rem;margin-bottom:8px}.checkout-container[_ngcontent-%COMP%]   .summary[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:700}.selected-bank[_ngcontent-%COMP%]{background:#0080001a;border-left:4px solid green;transition:background .3s ease,border-left .3s ease}.sticky-footer[_ngcontent-%COMP%]{position:fixed;bottom:0;left:0;width:100%;height:60px;color:#fff;font-size:1.2rem;font-weight:700;display:flex;justify-content:space-between;align-items:center;margin:0;border:none;--border-radius: 0px;z-index:1000}.footer-content[_ngcontent-%COMP%]{display:flex;justify-content:space-between;width:100%}.footer-content[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{flex:1;text-align:center}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}.date-time-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:16px}.date-time-container[_ngcontent-%COMP%]   .date-picker-container[_ngcontent-%COMP%]{position:relative;flex:1;z-index:0}.date-time-container[_ngcontent-%COMP%]   .date-picker-container[_ngcontent-%COMP%]   .tooltip-calendar[_ngcontent-%COMP%]{position:absolute;top:50px;left:0;z-index:1050;background:#fff;border:1px solid #d1d1d1;border-radius:8px;box-shadow:0 4px 8px #0000001a;padding:8px;width:300px}.date-time-container[_ngcontent-%COMP%]   .enhanced-box[_ngcontent-%COMP%]{border-radius:8px;padding:12px;transition:transform .2s ease-in-out,box-shadow .2s ease-in-out}.date-time-container[_ngcontent-%COMP%]   .enhanced-box[_ngcontent-%COMP%]:hover{transform:translateY(-2px)}.date-time-container[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{border-radius:8px;--padding-start: 12px;font-size:1rem}.premium-banner[_ngcontent-%COMP%]{background-color:#e0ffe6;color:#007f3d;padding:8px 12px;border-radius:8px;font-weight:600;margin-bottom:1rem;text-align:center}.aeropay-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;margin-top:16px}.aeropay-banks[_ngcontent-%COMP%]{width:100%}.aeropay-image[_ngcontent-%COMP%]{max-width:60%;margin-top:5px}.loading-container[_ngcontent-%COMP%]{display:flex;margin-top:20px}#widget[_ngcontent-%COMP%]{margin-top:20px}ion-radio[_ngcontent-%COMP%]::part(container){-webkit-appearance:none;-moz-appearance:none;appearance:none;display:inline-flex;width:24px;height:24px;border-radius:50%;border:2px solid #ccc;background-color:#fff}.cart-items[_ngcontent-%COMP%]{margin-top:20px}.cart-items[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;padding:0}.cart-items[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   .order-item[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:15px;border-bottom:1px solid rgba(0,0,0,.3);padding-bottom:10px}.cart-items[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   .order-item[_ngcontent-%COMP%]   img.item-image[_ngcontent-%COMP%]{width:60px;height:60px;object-fit:cover;border-radius:8px;margin-right:15px}.cart-items[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   .order-item[_ngcontent-%COMP%]   .item-details[_ngcontent-%COMP%]{display:flex;flex-direction:column}.cart-items[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   .order-item[_ngcontent-%COMP%]   .item-title[_ngcontent-%COMP%]{font-size:14px;font-weight:500}.cart-items[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   .order-item[_ngcontent-%COMP%]   .item-quantity[_ngcontent-%COMP%]{font-size:13px}.delivery-address[_ngcontent-%COMP%]{margin-top:16px;padding:16px;border-radius:8px;background-color:#f9f9f9;box-shadow:0 2px 5px #0000001a}.delivery-address[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:700;margin-bottom:12px}.delivery-address[_ngcontent-%COMP%]   .input-row[_ngcontent-%COMP%]{display:flex;gap:12px}.delivery-address[_ngcontent-%COMP%]   .rounded-input[_ngcontent-%COMP%]{border-radius:8px;--padding-start: 12px;margin-bottom:12px}"]}),a})();function pe(o,a){1&o&&(e.j41(0,"div",4),e.nrm(1,"ion-spinner",5),e.k0s())}function ue(o,a){1&o&&(e.j41(0,"p"),e.EFF(1,"\u{1f69a} Delivery Order"),e.k0s())}function ge(o,a){if(1&o&&(e.j41(0,"p",15),e.EFF(1),e.k0s()),2&o){const r=e.XpG().$implicit,t=e.XpG(2);e.R7$(),e.JRh(t.getLatestStatus(r))}}function me(o,a){if(1&o&&(e.j41(0,"li",19),e.nrm(1,"img",20),e.j41(2,"span"),e.EFF(3),e.k0s(),e.j41(4,"span"),e.EFF(5),e.k0s()()),2&o){const r=a.$implicit;e.R7$(),e.Y8G("src",""===r.image?"assets/default.png":r.image,e.B4B)("alt","Image of "+r.title),e.R7$(2),e.SpI("",r.quantity,"x"),e.R7$(2),e.JRh(r.title)}}function he(o,a){if(1&o){const r=e.RV6();e.j41(0,"div",16)(1,"ul"),e.DNE(2,me,6,4,"li",17),e.k0s(),e.j41(3,"button",18),e.bIt("click",function(){e.eBV(r);const n=e.XpG().$implicit,i=e.XpG(2);return e.Njj(i.reorder(n))}),e.EFF(4," Reorder "),e.k0s()()}if(2&o){const r=e.XpG().$implicit;e.R7$(2),e.Y8G("ngForOf",r.items),e.R7$(),e.BMQ("aria-label","Reorder items from order"+r.id_order)}}function _e(o,a){if(1&o){const r=e.RV6();e.j41(0,"div",8)(1,"div",9),e.bIt("click",function(){const n=e.eBV(r).index,i=e.XpG(2);return e.Njj(i.toggleExpand(n,"pending"))}),e.j41(2,"div",10)(3,"h3"),e.EFF(4),e.k0s(),e.j41(5,"p"),e.EFF(6),e.k0s(),e.DNE(7,ue,2,0,"p",11)(8,ge,2,1,"p",12),e.k0s(),e.j41(9,"div",13)(10,"p"),e.EFF(11),e.nI1(12,"number"),e.k0s()()(),e.DNE(13,he,5,2,"div",14),e.k0s()}if(2&o){const r=a.$implicit,t=a.index,n=e.XpG(2);e.AVh("expanded",n.expandedOrderIndex.pending===t),e.R7$(),e.BMQ("aria-expanded",n.expandedOrderIndex.pending===t)("aria-controls","pending-order-items-"+t)("aria-label","View details for order "+r.id_order),e.R7$(3),e.SpI("Order #",r.id_order,""),e.R7$(2),e.SpI("",r.items.length," items"),e.R7$(),e.Y8G("ngIf",r.status_list.length>0),e.R7$(),e.Y8G("ngIf",r.status_list.length>0),e.R7$(3),e.SpI("$",e.i5U(12,11,r.total,"1.2-2"),""),e.R7$(2),e.Y8G("ngIf",n.expandedOrderIndex.pending===t)}}function fe(o,a){if(1&o&&(e.j41(0,"div",6),e.DNE(1,_e,14,14,"div",7),e.k0s()),2&o){const r=e.XpG();e.R7$(),e.Y8G("ngForOf",r.pendingOrders)}}function ye(o,a){1&o&&(e.j41(0,"div",4),e.nrm(1,"ion-spinner",5),e.k0s())}function Ce(o,a){1&o&&(e.j41(0,"p"),e.EFF(1,"\u{1f69a} Delivery Order"),e.k0s())}function ke(o,a){if(1&o&&(e.j41(0,"p",15),e.EFF(1),e.k0s()),2&o){const r=e.XpG().$implicit,t=e.XpG(2);e.R7$(),e.JRh(t.getLatestStatus(r))}}function ve(o,a){if(1&o&&(e.j41(0,"li",19),e.nrm(1,"img",20),e.j41(2,"span"),e.EFF(3),e.k0s(),e.j41(4,"span"),e.EFF(5),e.k0s()()),2&o){const r=a.$implicit;e.R7$(),e.Y8G("src",r.image,e.B4B)("alt","Image of "+r.title),e.R7$(2),e.SpI("",r.quantity,"x"),e.R7$(2),e.JRh(r.title)}}function Me(o,a){if(1&o){const r=e.RV6();e.j41(0,"div",16)(1,"ul"),e.DNE(2,ve,6,4,"li",17),e.k0s(),e.j41(3,"ion-button",18),e.bIt("click",function(){e.eBV(r);const n=e.XpG().$implicit,i=e.XpG(2);return e.Njj(i.reorder(n))}),e.EFF(4," Reorder "),e.k0s()()}if(2&o){const r=e.XpG().$implicit;e.R7$(2),e.Y8G("ngForOf",r.items),e.R7$(),e.BMQ("aria-label","Reorder items from order "+r.id_order)}}function be(o,a){if(1&o){const r=e.RV6();e.j41(0,"div",8)(1,"div",9),e.bIt("click",function(){const n=e.eBV(r).index,i=e.XpG(2);return e.Njj(i.toggleExpand(n,"past"))}),e.j41(2,"div",10)(3,"h3"),e.EFF(4),e.k0s(),e.j41(5,"p"),e.EFF(6),e.k0s(),e.DNE(7,Ce,2,0,"p",11)(8,ke,2,1,"p",12),e.k0s(),e.j41(9,"div",13)(10,"p"),e.EFF(11),e.nI1(12,"number"),e.k0s()()(),e.DNE(13,Me,5,2,"div",14),e.k0s()}if(2&o){const r=a.$implicit,t=a.index,n=e.XpG(2);e.AVh("expanded",n.expandedOrderIndex.past===t),e.R7$(),e.BMQ("aria-expanded",n.expandedOrderIndex.past===t)("aria-controls","past-order-items-"+t)("aria-label","View details for order "+r.id_order),e.R7$(3),e.SpI("Order #",r.id_order,""),e.R7$(2),e.SpI("",r.items.length," items"),e.R7$(),e.Y8G("ngIf",r.status_list.length>0),e.R7$(),e.Y8G("ngIf",r.status_list.length>0),e.R7$(3),e.SpI("$",e.i5U(12,11,r.total,"1.2-2"),""),e.R7$(2),e.Y8G("ngIf",n.expandedOrderIndex.past===t)}}function Pe(o,a){if(1&o&&(e.j41(0,"div",21),e.DNE(1,be,14,14,"div",7),e.k0s()),2&o){const r=e.XpG();e.R7$(),e.Y8G("ngForOf",r.pastOrders)}}let Oe=(()=>{var o;class a{constructor(t,n,i){this.authService=t,this.cartService=n,this.accessibilityService=i,this.pendingOrders=[],this.pastOrders=[],this.loading=!0,this.expandedOrderIndex={pending:null,past:null}}ngOnInit(){this.loading=!0,this.authService.orders.subscribe(t=>{setTimeout(()=>{t.sort((n,i)=>i.id_order-n.id_order),this.pendingOrders=t.filter(n=>!n.complete),this.pastOrders=t.filter(n=>n.complete),this.loading=!1},500)})}getLatestStatus(t){return t.status_list&&t.status_list.length>0?t.status_list.reduce((n,i)=>new Date(i.created_at)>new Date(n.created_at)?i:n).customer_message:""}sendStatusNotification(t,n){return(0,g.A)(function*(){const i={userId:t,title:"Order Update",body:`Your order status: ${n}`},s=localStorage.getItem("sessionData"),l={Authorization:s?JSON.parse(s).token:null,"Content-Type":"application/json"};try{yield R.pX.post({url:`${_.c.apiUrl}/notifications/send-push`,headers:l,data:i}),console.log("Order status notification sent:",n)}catch(h){console.error("Error sending notification",h)}})()}toggleExpand(t,n){const i=this.expandedOrderIndex[n]===t;this.expandedOrderIndex[n]=i?null:t,this.accessibilityService.announce(i?`Order ${n} #${t+1} collapsed.`:`Order ${n} #${t+1} expanded.`,"polite")}reorder(t){t.items.forEach(i=>{this.cartService.addToCart({id:i.id,posProductId:i.posProductId,id_batch:i.id_batch,image:i.image,brand:i.brand,desc:i.desc,price:i.price,quantity:i.quantity,title:i.title,strainType:i.strainType,thc:i.thc,weight:i.weight,category:i.category})}),this.accessibilityService.announce(`Order #${t.id_order} items have been added to your cart.`,"assertive"),console.log("Order added to cart:",t)}}return(o=a).\u0275fac=function(t){return new(t||o)(e.rXU(F.u),e.rXU(T.m),e.rXU(I.s))},o.\u0275cmp=e.VBU({type:o,selectors:[["app-recent-orders"]],decls:9,vars:4,consts:[[1,"order-history"],["class","loading-container",4,"ngIf"],["class","order-list","role","region","aria-labelledby","pending-orders-heading",4,"ngIf"],["class","order-list","role","region","aria-labelledby","past-orders-heading",4,"ngIf"],[1,"loading-container"],["name","crescent"],["role","region","aria-labelledby","pending-orders-heading",1,"order-list"],["class","order-card",3,"expanded",4,"ngFor","ngForOf"],[1,"order-card"],[1,"order-header",3,"click"],[1,"order-info"],[4,"ngIf"],["class","status-badge",4,"ngIf"],[1,"order-amount"],["class","order-items",4,"ngIf"],[1,"status-badge"],[1,"order-items"],["class","order-item",4,"ngFor","ngForOf"],[1,"reorder-button",3,"click"],[1,"order-item"],[1,"item-image",3,"src","alt"],["role","region","aria-labelledby","past-orders-heading",1,"order-list"]],template:function(t,n){1&t&&(e.j41(0,"div",0)(1,"h2"),e.EFF(2,"Pending Orders"),e.k0s(),e.DNE(3,pe,2,0,"div",1)(4,fe,2,1,"div",2),e.j41(5,"h2"),e.EFF(6,"Past Orders"),e.k0s(),e.DNE(7,ye,2,0,"div",1)(8,Pe,2,1,"div",3),e.k0s()),2&t&&(e.R7$(3),e.Y8G("ngIf",n.loading),e.R7$(),e.Y8G("ngIf",!n.loading),e.R7$(3),e.Y8G("ngIf",n.loading),e.R7$(),e.Y8G("ngIf",!n.loading))},dependencies:[y.Sq,y.bT,d.Jm,d.w2,y.QX],styles:[".order-history[_ngcontent-%COMP%]{width:100%;max-width:600px;margin:0 auto;padding:16px;font-family:Arial,sans-serif}.order-history[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;margin-bottom:24px}.order-history[_ngcontent-%COMP%]   .order-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.order-history[_ngcontent-%COMP%]   .order-list[_ngcontent-%COMP%]   .order-card[_ngcontent-%COMP%]{border:1px solid #e0e0e0;border-radius:8px;background-color:#fff;overflow:hidden;transition:max-height .3s ease}.order-history[_ngcontent-%COMP%]   .order-list[_ngcontent-%COMP%]   .order-card.expanded[_ngcontent-%COMP%]{max-height:500px}.order-history[_ngcontent-%COMP%]   .order-list[_ngcontent-%COMP%]   .order-card[_ngcontent-%COMP%]   .order-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:16px;cursor:pointer}.order-history[_ngcontent-%COMP%]   .order-list[_ngcontent-%COMP%]   .order-card[_ngcontent-%COMP%]   .order-header[_ngcontent-%COMP%]   .order-info[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:700;margin:0}.order-history[_ngcontent-%COMP%]   .order-list[_ngcontent-%COMP%]   .order-card[_ngcontent-%COMP%]   .order-header[_ngcontent-%COMP%]   .order-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.9rem;margin:4px 0}.order-history[_ngcontent-%COMP%]   .order-list[_ngcontent-%COMP%]   .order-card[_ngcontent-%COMP%]   .order-header[_ngcontent-%COMP%]   .order-amount[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1rem;font-weight:700;margin:0;text-align:right}.order-history[_ngcontent-%COMP%]   .order-list[_ngcontent-%COMP%]   .order-card[_ngcontent-%COMP%]   .order-items[_ngcontent-%COMP%]{padding:20px}.order-history[_ngcontent-%COMP%]   .order-list[_ngcontent-%COMP%]   .order-card[_ngcontent-%COMP%]   .order-items[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;padding:0}.order-history[_ngcontent-%COMP%]   .order-list[_ngcontent-%COMP%]   .order-card[_ngcontent-%COMP%]   .order-items[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   .order-item[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:10px}.order-history[_ngcontent-%COMP%]   .order-list[_ngcontent-%COMP%]   .order-card[_ngcontent-%COMP%]   .order-items[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   .order-item[_ngcontent-%COMP%]   img.item-image[_ngcontent-%COMP%]{width:40px;height:40px;object-fit:cover;border-radius:4px;margin-right:10px}.order-history[_ngcontent-%COMP%]   .order-list[_ngcontent-%COMP%]   .order-card[_ngcontent-%COMP%]   .order-items[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   .order-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-right:10px;font-size:14px}.reorder-button[_ngcontent-%COMP%]{background-color:var(--ion-color-primary);color:#fff;border:none;padding:10px 15px;margin-top:10px;border-radius:5px;cursor:pointer;font-size:14px}.loading-container[_ngcontent-%COMP%]{text-align:center;margin:auto}.loading-spinner[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;padding:20px;color:#000;text-align:center;margin:auto}"]}),a})();function xe(o,a){if(1&o){const r=e.RV6();e.qex(0),e.nrm(1,"app-cart-items",3),e.j41(2,"div",4)(3,"ion-button",5),e.bIt("click",function(){e.eBV(r);const n=e.XpG(2);return e.Njj(n.checkout())}),e.EFF(4,"Continue"),e.k0s()(),e.bVm()}if(2&o){const r=e.XpG(2);e.R7$(),e.Y8G("items",r.cartItems)}}function Te(o,a){1&o&&(e.j41(0,"div",6),e.nrm(1,"ion-icon",7),e.j41(2,"p"),e.EFF(3,"Your cart is empty!"),e.k0s(),e.j41(4,"ion-button",8),e.EFF(5,"Browse Products"),e.k0s()())}function Ie(o,a){if(1&o&&(e.j41(0,"div"),e.DNE(1,xe,5,1,"ng-container",2)(2,Te,6,0,"ng-template",null,0,e.C5r),e.nrm(4,"app-recent-orders"),e.k0s()),2&o){const r=e.sdS(3),t=e.XpG();e.R7$(),e.Y8G("ngIf",t.cartItems.length>0)("ngIfElse",r)}}function Fe(o,a){if(1&o){const r=e.RV6();e.j41(0,"div")(1,"app-checkout",9),e.bIt("back",function(){e.eBV(r);const n=e.XpG();return e.Njj(n.removeCheckout())})("orderPlaced",function(){e.eBV(r);const n=e.XpG();return e.Njj(n.onOrderPlaced())}),e.k0s()()}if(2&o){const r=e.XpG();e.R7$(),e.Y8G("checkoutInfo",r.checkoutInfo)}}const Re=[{path:"",component:(()=>{var o;class a{constructor(t,n,i,s,c,l){this.cartService=t,this.toastController=n,this.loadingController=i,this.authService=s,this.accessibilityService=c,this.router=l,this.showCheckout=!1,this.showConfirmation=!1,this.checkoutUrl="",this.cartItems=[],this.isLoading=!1}ngOnInit(){this.cartService.cart$.subscribe(t=>{this.cartItems=t})}checkout(){var t=this;return(0,g.A)(function*(){t.isLoading=!0;const n=yield t.loadingController.create({message:"Processing Checkout...",spinner:"crescent"});yield n.present(),t.checkoutInfo={cart:t.cartItems,user_info:t.authService.getCurrentUser()},t.showCheckout=!0,n.dismiss(),t.accessibilityService.announce("Checkout process started.","polite")})()}removeCheckout(){this.showCheckout=!1,this.accessibilityService.announce("Returned to cart.","polite")}onOrderPlaced(){var t=this;return(0,g.A)(function*(){t.resetCart(),t.showCheckout=!1,t.scrollToTop(),t.accessibilityService.announce("Your order was placed successfully.","polite"),console.log("redirecting"),t.redirectToCart()})()}ionViewDidEnter(){this.scrollToTop()}scrollToTop(){this.content?this.content.scrollToTop(300):console.warn("IonContent is not available.")}presentToast(t,n="success"){var i=this;return(0,g.A)(function*(){yield(yield i.toastController.create({message:t,duration:5e3,color:n,position:"bottom"})).present()})()}resetCart(){console.log("resetting cart"),this.cartService.clearCart(),this.cartItems=[],this.checkoutInfo=null,this.accessibilityService.announce("Your cart has been cleared.","polite")}redirectToCart(){var t=this;return(0,g.A)(function*(){yield t.router.navigateByUrl("/cart"),setTimeout((0,g.A)(function*(){location.reload(),yield t.presentToast("Your order has been placed successfully!")}),500)})()}}return(o=a).\u0275fac=function(t){return new(t||o)(e.rXU(T.m),e.rXU(d.K_),e.rXU(d.Xi),e.rXU(F.u),e.rXU(I.s),e.rXU(O.Ix))},o.\u0275cmp=e.VBU({type:o,selectors:[["app-cart"]],viewQuery:function(t,n){if(1&t&&e.GBs(d.W9,5),2&t){let i;e.mGM(i=e.lsd())&&(n.content=i.first)}},decls:4,vars:2,consts:[["emptyCart",""],[4,"ngIf"],[4,"ngIf","ngIfElse"],[3,"items"],[1,"checkout-container"],["aria-label","Proceed to checkout",1,"checkout-button",3,"click"],["role","alert","aria-live","polite",1,"empty-cart-message"],["name","cart-outline","size","large","aria-hidden","true"],["routerLink","/products","aria-label","Browse available products"],["aria-label","Checkout section",3,"back","orderPlaced","checkoutInfo"]],template:function(t,n){1&t&&(e.j41(0,"ion-content"),e.nrm(1,"app-header"),e.DNE(2,Ie,5,2,"div",1)(3,Fe,2,1,"div",1),e.k0s()),2&t&&(e.R7$(2),e.Y8G("ngIf",!n.showCheckout&&!n.showConfirmation),e.R7$(),e.Y8G("ngIf",n.showCheckout))},dependencies:[y.bT,d.Jm,d.W9,d.iq,d.N7,O.Wk,$.l,G,le,Oe],styles:[".checkout-container[_ngcontent-%COMP%]{width:100%;text-align:right;padding:16px}.checkout-container[_ngcontent-%COMP%]   .checkout-button[_ngcontent-%COMP%]{text-transform:capitalize;margin-left:auto;width:40%}.empty-cart-message[_ngcontent-%COMP%]{text-align:center;padding:40px 20px}.empty-cart-message[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:64px;color:#ccc}.empty-cart-message[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:18px;color:#666;margin-top:10px}.empty-cart-message[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{margin-top:20px}.loading-overlay[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);z-index:100;display:flex;justify-content:center;align-items:center;background:#fffc;width:100%;height:100%}"]}),a})()}];let De=(()=>{var o;class a{}return(o=a).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.$C({type:o}),o.\u0275inj=e.G2t({imports:[O.iI.forChild(Re),O.iI]}),a})();var je=u(3887);let Ae=(()=>{var o;class a{}return(o=a).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.$C({type:o}),o.\u0275inj=e.G2t({imports:[y.MD,b.YN,d.bv,De,je.G]}),a})()}}]);